<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å‡ºè·æ¤œæŸ»æˆç¸¾æ›¸ã‚ªãƒ¼ã‚¯ãƒå°‚ç”¨MB46V</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* ======= GLOBAL ======= */
    html, body {
      background: #e7e7e7;
      margin: 0; padding: 0;
      font-family: Arial, sans-serif;
      font-size: 3.5mm; height: 100%;
    }
    .no-print { display: initial; }
    .print-text { display: none; }

    /* Konsistensi font (termasuk date) */
    input, select { font-size: 3.2mm; padding: .5mm; box-sizing: border-box; font-family: Arial, sans-serif; }
    input[type="date"] { font-family: inherit; -webkit-appearance: none; appearance: none; line-height: 1.2; }

    /* Hilangkan kotak (border) dari semua input di tabel */
    table input,
    table input[type="date"],
    .td-measure-grid input {
      border: none; outline: none; background: transparent; box-shadow: none; border-radius: 0;
      padding: 0 1mm; width: 100%; height: 100%; box-sizing: border-box; -webkit-appearance: none; appearance: none;
    }
    table input:focus,
    table input[type="date"]:focus { outline: none; box-shadow: none; }

    /* ======= SCREEN LAYOUT ======= */
    @media screen {
      html, body { display: flex; flex-direction: column; align-items: center; }
      .b5-preview { margin: 12mm 0; }
    }

    .b5-preview {
      background: #fff;
      width: 176mm; max-width: 98vw;  /* B5 width */
      margin: 10mm auto; padding: 8mm;
      box-shadow: 0 0 5mm rgba(0,0,0,.25);
      box-sizing: border-box;
    }

    h2 { text-align: center; font-size: 7mm; margin-bottom: 8mm; }

    table { width: 100%; border-collapse: collapse; margin-bottom: 4mm; }
    th, td { border: .3mm solid #333; padding: 1.2mm 1mm; text-align: center; background: #fff; vertical-align: middle; }
    th { background: #f0f0f0; }
    .section-label { text-align: left; font-weight: bold; background: #f9f9f9; }

    /* Header table: no wrap biar lurus */
    .header-table td, .header-table th { white-space: nowrap; word-break: keep-all; }
    .header-table input { min-width: 0; }

    .button { margin: 3mm 1mm 0 0; padding: 2mm 8mm; font-size: 3.5mm; }

    .td-measure { padding: 0 !important; }
    .td-measure-grid { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 1mm; }
    .td-measure-grid input { text-align: right; }

    .inputter-row { display: flex; align-items: center; gap: 2mm; margin-bottom: 3mm; }
    .inputter-row label { width: 12mm; font-weight: bold; }
    .inputter-row select { width: 30%; }

    /* ======= STAMPS ======= */
    .stamp-box-row { display: flex; justify-content: flex-end; gap: 4mm; margin-top: 3mm; }
    .stamp-box-row > div { display: flex; flex-direction: column; align-items: center; }
    .stamp-label { font-size: 3mm; margin-bottom: 1mm; text-align: center; }
    .signature-box {
      width: 15mm; height: 15mm; border: .3mm solid #333; border-radius: 2mm;
      background: #fafbfc; display: flex; align-items: center; justify-content: center; overflow: hidden;
    }
    .signature-box img { width: 9mm; height: 9mm; object-fit: contain; }

    .company-name { text-align: right; margin: 2mm 1mm 0; font-weight: bold; }
    .order-no-row .section-label { width: 15%; }
    .order-no-row .data { width: 85%; }

    /* ======= FLOATING TOOLBAR ======= */
    .toolbar {
      position: fixed; top: 12px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 8px; padding: 8px 10px;
      background: rgba(255,255,255,0.92);
      border: 1px solid #ddd; border-radius: 12px;
      box-shadow: 0 2px 18px rgba(0,0,0,.12);
      z-index: 9999; backdrop-filter: blur(4px);
    }
    .toolbar button {
      font-family: Arial, sans-serif; font-size: 14px;
      padding: 8px 14px; border-radius: 8px;
      border: 1px solid #ccc; background: #fff; cursor: pointer;
    }
    .toolbar button:hover { filter: brightness(.96); }
    @media (max-width: 560px) {
      .toolbar { top: 8px; gap: 6px; padding: 6px 8px; }
      .toolbar button { padding: 6px 10px; font-size: 13px; }
    }

    /* ======= PRINT STYLES ======= */
    @media print {
      @page { size: B5 portrait; margin: 12mm; }  /* safe margin */
      html, body { background: none !important; margin: 0 !important; padding: 0 !important; }
      .toolbar { display: none !important; }

      .b5-preview {
        width: 100%; margin: 0; padding: 0; box-shadow: none; box-sizing: border-box;
        transform: scale(0.97);               /* kecilkan dikit supaya selalu 1 halaman */
        transform-origin: top left;
      }
      table { width: 100%; }

      /* sembunyikan yang tidak perlu & tampilkan mirror */
      .no-print { display: none !important; }
      .print-text { display: inline !important; }

      /* pastikan input tetap tanpa kotak saat print */
      table input,
      table input[type="date"],
      .td-measure-grid input {
        border: none !important; outline: none !important;
        background: transparent !important; box-shadow: none !important; border-radius: 0 !important;
      }

      .signature-box img[src=""] { display: none !important; }
      .stamp-box-row, .signature-box { display: flex !important; }

      * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }

    /* ======= INVALID HIGHLIGHT (tidak ikut tercetak) ======= */
    .td-measure-grid input.invalid {
      background: #ffebee;
      box-shadow: inset 0 0 0 1px #d32f2f;
    }
    @media print {
      .td-measure-grid input.invalid { background: transparent !important; box-shadow: none !important; }
    }
  </style>
</head>
<body>
  <!-- Floating toolbar -->
  <div class="toolbar">
    <button type="button" onclick="printViaPDF()">ğŸ–¨ï¸ å°åˆ·</button>
    <button type="button" onclick="saveAsPDF()">ğŸ“„ PDFä¿å­˜</button>
    <button type="button" onclick="clearAllFields()">ğŸ§¹ å…¨ã¦ã‚¯ãƒªã‚¢</button>
  </div>

  <form id="inspection-form">
    <div class="b5-preview">
      <h2>å‡ºè·æ¤œæŸ»æˆç¸¾æ›¸</h2>

      <!-- HEADER TABLE -->
      <table class="header-table">
        <tr>
          <td class="section-label">å®¢å…ˆ</td>
          <td style="width:25%;">ã‚ªãƒ¼ã‚¯ãƒæ ªå¼ä¼šç¤¾ æ®¿</td>
          <td class="section-label">ç™ºè¡ŒNo.</td>
          <td><input type="text" name="customer_no" placeholder="ä¾‹: TTS60-01-460" /></td>
          <td class="section-label">ç™ºè¡Œå¹´æœˆæ—¥</td>
          <td>
            <input type="date" name="hakkohiduke" class="no-print" />
            <span class="print-text" data-from="hakkohiduke"></span>
          </td>
        </tr>
        <tr>
          <td class="section-label">æ©Ÿç¨®</td><td>MB-46V</td>
          <td class="section-label">å“ç•ª</td>
          <td><input type="text" name="part_no" placeholder="ä¾‹: H1090-0021-02-5" /></td>
          <td class="section-label">å›³ç•ª</td><td>2825-20</td>
        </tr>
        <tr>
          <td class="section-label">å“å</td><td>Yè»¸SG</td>
          <td class="section-label">è£½é€ æ—¥</td>
          <td>
            <input type="date" name="makingdate" class="no-print" />
            <span class="print-text" data-from="makingdate"></span>
          </td>
          <td class="section-label">è£½é€ No</td>
          <td><input type="text" name="serial_no" placeholder="ä¾‹: Y282520-2245" /></td>
        </tr>
        <tr class="order-no-row">
          <td class="section-label">ã‚ªãƒ¼ãƒ€ãƒ¼No</td>
          <td class="data" colspan="5"><input type="text" name="order_no" placeholder="ä¾‹: 102P068219-001" /></td>
        </tr>
      </table>

      <!-- INPUTTER (Hanya layar) -->
      <div class="inputter-row no-print">
        <label>å…¥åŠ›è€…</label>
        <select name="inputter">
          <option value="">- é¸æŠã—ã¦ãã ã•ã„ -</option>
          <option value="é•·è°·éƒ¨">é•·è°·éƒ¨</option>
          <option value="éƒ½åˆ">éƒ½åˆ</option>
          <option value="çŸ³æ©‹">çŸ³æ©‹</option>
        </select>
      </div>

      <!-- INSPECTION ITEMS -->
      <table>
        <tr><th>æ¤œæŸ»é …ç›®</th><th>è¦æ ¼</th><th>åˆ¤å®š</th></tr>
        <tr>
          <td>æœ¬ä½“å–ä»˜ã‘å¯¸æ³•</td><td>çµ„ç«‹æ¶å°å–ä»˜åˆã‚ã›ç¢ºèª</td>
          <td>
            <select name="judge1" class="no-print judge-select"><option>åˆ</option><option>å¦</option></select>
            <span class="print-text"></span>
          </td>
        </tr>
        <tr>
          <td>æ‘ºå‹•ãƒ†ã‚¹ãƒˆ</td><td>æ‘ºå‹•ãƒ†ã‚¹ãƒˆå°èµ°ã‚Šãƒ»æ©Ÿèƒ½ç¢ºèª</td>
          <td>
            <select name="judge2" class="no-print judge-select"><option>åˆ</option><option>å¦</option></select>
            <span class="print-text"></span>
          </td>
        </tr>
        <tr>
          <td>æ‘ºå‹•æ™‚ã®ç•°éŸ³</td><td>ç•°éŸ³ã®æœ‰ç„¡ç¢ºèª</td>
          <td>
            <select name="judge3" class="no-print judge-select"><option>ç„¡</option><option>æœ‰</option></select>
            <span class="print-text"></span>
          </td>
        </tr>
        <tr>
          <td>å¤–è¦³æ¤œæŸ»</td><td>ã‚­ã‚ºãƒ»ãƒãƒªã®æœ‰ç„¡ç¢ºèª</td>
          <td>
            <select name="judge4" class="no-print judge-select"><option>åˆ</option><option>å¦</option></select>
            <span class="print-text"></span>
          </td>
        </tr>
        <tr>
          <td>ã‚«ãƒãƒ¼ãƒ¯ã‚¤ãƒ‘ãƒ¼ã®é™¤éš…</td><td>ãƒ¯ã‚¤ãƒ‘ãƒ¼æ t=0.05ã«ã¦ç¢ºèª</td>
          <td>
            <select name="judge5" class="no-print judge-select"><option>åˆ</option><option>å¦</option></select>
            <span class="print-text"></span>
          </td>
        </tr>
      </table>

      <!-- MEASUREMENTS -->
      <table>
        <tr><th>é …ç›®</th><th>åŸºæº–å€¤</th><th>æ¸¬å®šå€¤</th></tr>
        <tr>
          <td>åç¸®æ™‚é•·ã•(a)</td>
          <td>190 mmä»¥ä¸‹</td>
          <td class="td-measure">
            <div class="td-measure-grid">
              <!-- integer: max 3 digit -->
              <input type="text" inputmode="numeric" name="a_length" placeholder="0-190" data-min="0" data-max="190" />
              <span>mm</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>ä¼¸é•·æ™‚é•·ã•(b)</td>
          <td>670 mmä»¥ä¸Š</td>
          <td class="td-measure">
            <div class="td-measure-grid">
              <!-- integer: max 3 digit (670+) -->
              <input type="text" inputmode="numeric" name="b_length" placeholder=">=670" data-min="670" />
              <span>mm</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>ã‚«ãƒãƒ¼ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯(s)</td>
          <td>480 mmä»¥ä¸Š</td>
          <td class="td-measure">
            <div class="td-measure-grid">
              <!-- integer: max 3 digit (480+) -->
              <input type="text" inputmode="numeric" name="c_length" placeholder=">=480" data-min="480" />
              <span>mm</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>åˆæœŸæ‘ºå‹•æŠµæŠ—</td>
          <td>4.0 kgä»¥ä¸‹</td>
          <td class="td-measure">
            <div class="td-measure-grid">
              <!-- decimal allowed: 1 place -->
              <input type="text" inputmode="decimal" step="0.1" name="start_resist" placeholder="0-4.0" data-min="0" data-max="4" />
              <span>kg</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>ä¸­æœŸæ‘ºå‹•æŠµæŠ—</td>
          <td>4.0 kgä»¥ä¸‹</td>
          <td class="td-measure">
            <div class="td-measure-grid">
              <input type="text" inputmode="decimal" step="0.1" name="mid_resist" placeholder="0-4.0" data-min="0" data-max="4" />
              <span>kg</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>çµ‚æœŸæ‘ºå‹•æŠµæŠ—</td>
          <td>4.0 kgä»¥ä¸‹</td>
          <td class="td-measure">
            <div class="td-measure-grid">
              <input type="text" inputmode="decimal" step="0.1" name="end_resist" placeholder="0-4.0" data-min="0" data-max="4" />
              <span>kg</span>
            </div>
          </td>
        </tr>
      </table>

      <!-- FINAL JUDGMENT & REMARKS -->
      <div style="margin:2mm 0;">
        <label style="font-weight:bold;">ç·åˆåˆ¤å®š</label>
        <select name="final_judgment" class="no-print judge-select" style="margin-left:10mm;">
          <option>åˆ</option><option>å¦</option>
        </select>
        <span class="print-text"></span>
      </div>
      <div style="margin:2mm 0;">
        <label style="font-weight:bold;">[å‚™è€ƒ]</label>
        <input type="text" name="bikou" style="width:70%;" />
      </div>

      <!-- Fallback buttons (hidden on screen) -->
      <!--<button type="button" class="button no-print" onclick="printViaPDF()">å°åˆ·</button>
      <button type="button" class="button no-print" onclick="saveAsPDF()">PDFä¿å­˜</button>
      <button type="button" class="button no-print" id="clearAllBtn">å…¨ã‚¯ãƒªã‚¢</button> -->

      <!-- COMPANY & STAMPS -->
      <div class="company-name">æ±äº¬ç²¾å¯†ç™ºæ¢æ ªå¼ä¼šç¤¾</div>
      <div class="stamp-box-row">
        <div>
          <!-- dropdown stempel: TIDAK dimirror -->
          <select class="no-print" onchange="updateStampPreview('stamp1',this.value)">
            <option value="">- å°é‘‘é¸æŠ -</option>
            <option value="nakagawa.png">ä¸­å·éƒ¨é•·</option>
            <option value="hasebe.png">é•·è°·éƒ¨</option>
            <option value="ishibashi.png">çŸ³æ©‹</option>
            <option value="togo.png">éƒ½åˆ</option>
            <option value="wahyu.png">ãƒ¯ãƒ¼ãƒ¦</option>
            <option value="yusuf.png">ãƒ¦ã‚¹ãƒ•</option>
          </select>
          <div class="stamp-label">æ¤œå°</div>
          <div class="signature-box"><img id="stamp1" src="" alt=""></div>
        </div>
        <div>
          <select class="no-print" onchange="updateStampPreview('stamp2',this.value)">
            <option value="">- å°é‘‘é¸æŠ -</option>
            <option value="nakagawa.png">ä¸­å·éƒ¨é•·</option>
            <option value="hasebe.png">é•·è°·éƒ¨</option>
            <option value="ishibashi.png">çŸ³æ©‹</option>
            <option value="togo.png">éƒ½åˆ</option>
            <option value="wahyu.png">ãƒ¯ãƒ¼ãƒ¦</option>
            <option value="yusuf.png">ãƒ¦ã‚¹ãƒ•</option>
          </select>
          <div class="stamp-label">æ¤œæŸ»å°</div>
          <div class="signature-box"><img id="stamp2" src="" alt=""></div>
        </div>
      </div>
    </div>
  </form>

  <script>
    function updateStampPreview(id, src) { document.getElementById(id).src = src || ''; }
    function clearAllFields() {
      const form = document.getElementById('inspection-form');
      form.reset();
      ['stamp1','stamp2'].forEach(id => document.getElementById(id).src = '');
      // bersihkan highlight invalid
      form.querySelectorAll('.td-measure-grid input.invalid').forEach(el => el.classList.remove('invalid'));
      // refresh mirror select
      wireJudgeMirror();
      // refresh mirror date
      wireDateMirror();
    }
    document.getElementById('clearAllBtn')?.addEventListener('click', clearAllFields);

   // ===== Validasi "æ¸¬å®šå€¤" (terima . fullwidth/koma & biarkan trailing dot) =====
(function wireMeasureValidation() {
  const fields = document.querySelectorAll('.td-measure-grid input');

  // Normalisasi berbagai "titik" & koma ke '.'
  const normalizeDecimalChars = (s) =>
    s.replace(/[ï¼Œ,]/g, '.').replace(/[ï¼ï½¡ã€‚]/g, '.');

  fields.forEach(inp => {
    const allowDecimal = (inp.getAttribute('step') || '').includes('.');
    const MAX_INT_DIGITS = 4;  // konsisten 4 digit

    inp.addEventListener('input', () => {
      // 1) Normalisasi karakter desimal dari IME/locale
      let v = normalizeDecimalChars(inp.value);

      // 2) Saring karakter non-digit/non-dot
      v = v.replace(/[^\d.]/g, '');

      // 3) Pastikan hanya ada 1 dot: gabungkan sisa bagian sebagai fraksi mentah
      if ((v.match(/\./g) || []).length > 1) {
        const [head, ...rest] = v.split('.');
        v = head + '.' + rest.join('').replace(/\D/g, '');
      }

      // 4) Pisahkan bagian integer & fraksi
      if (v.includes('.')) {
        let [d = '', f = ''] = v.split('.');
        const dTrim = d.slice(0, MAX_INT_DIGITS);

        if (allowDecimal) {
          // Batasi fraksi 1 digit; biarkan trailing '.' sementara jika belum ada fraksi
          const fTrim = (f ?? '').replace(/\D/g, '').slice(0, 1);
          v = f === '' ? `${dTrim}.` : `${dTrim}.${fTrim}`;
        } else {
          // Field integer: buang fraksi & titik
          v = dTrim;
        }
      } else {
        // Tidak ada titik â†’ batasi panjang integer
        v = v.slice(0, MAX_INT_DIGITS);
      }

      inp.value = v;
      inp.classList.remove('invalid');
    });

    inp.addEventListener('blur', () => {
      let v = normalizeDecimalChars(inp.value);
      if (v === '') { inp.classList.remove('invalid'); return; }

      // Jika user tinggalkan trailing dot (mis. "7.") â†’ jadikan "7.0"
      if (allowDecimal && /\.$/.test(v)) v = v.replace(/\.$/, '.0');

      // Hitung & validasi rentang
      const n = parseFloat(v);
      const min = parseFloat(inp.dataset.min ?? '-Infinity');
      const max = parseFloat(inp.dataset.max ?? 'Infinity');

      const inRange =
        !Number.isNaN(n) &&
        n >= (Number.isFinite(min) ? min : -Infinity) &&
        n <= (Number.isFinite(max) ? max : Infinity);

      if (!inRange) {
        inp.value = '';
        inp.classList.add('invalid');
        return;
      }

      // Format akhir: bulatkan 1 desimal untuk field desimal
      if (allowDecimal) {
        inp.value = n.toFixed(1).replace(/\.0$/, '.0');
      } else {
        // pastikan integer murni tanpa titik
        inp.value = String(Math.trunc(n)).slice(0, 4);
      }
      inp.classList.remove('invalid');
    });
  });
})();

// ===== Navigasi Enter di SEMUA field (input, select, textarea) =====
    function wireEnterNavigationAll() {
      const form = document.getElementById('inspection-form');

      // Ambil semua field fokusable di dalam form, urut DOM
      const getFields = () => Array.from(
        form.querySelectorAll('input, select, textarea')
      ).filter(el =>
        !el.disabled &&
        el.type !== 'hidden' &&
        el.offsetParent !== null // tidak tersembunyi (display:none/visibility)
      );

      // Helper: pindah fokus sesuai arah (+1 maju, -1 mundur)
      const moveFocus = (fromEl, dir = +1) => {
        const list = getFields(); // ambil ulang untuk kondisi dinamis
        const i = list.indexOf(fromEl);
        if (i === -1) return;
        let j = i + dir;

        // Cycling: akhir -> awal, awal -> akhir
        if (j >= list.length) j = 0;
        if (j < 0) j = list.length - 1;

        const next = list[j];
        next?.focus?.();

        // Untuk input teks/angka/date: auto-select agar cepat overwrite
        if (next && next.tagName === 'INPUT' && next.type !== 'checkbox' && next.type !== 'radio' && next.type !== 'file') {
          next.select?.();
        }
      };

      // Pasang handler sekali per elemen (hindari duplikasi)
      getFields().forEach(el => {
        if (el.dataset.enterNavWired === '1') return;
        el.dataset.enterNavWired = '1';

        el.addEventListener('keydown', (e) => {
          // Jangan ganggu saat masih composing IME (JP)
          if (e.isComposing || e.keyCode === 229) return;

          if (e.key === 'Enter') {
            // Pada textarea, kalau mau multi-line, comment baris ini:
            e.preventDefault(); // cegah submit / newline
            const backward = e.shiftKey === true; // Shift+Enter = mundur
            moveFocus(el, backward ? -1 : +1);
          }
        });
      });
    }
    // Mirror tanggal -> span (agar konsisten saat print)
    function wireDateMirror(){
      document.querySelectorAll('input[type="date"]').forEach(inp=>{
        const span = document.querySelector(`.print-text[data-from="${inp.name}"]`);
        if (!span) return;
        const fmt = v => v ? v.replace(/(\d{4})-(\d{2})-(\d{2})/, '$1/$2/$3') : '';
        const upd = ()=> span.textContent = fmt(inp.value);
        inp.addEventListener('change', upd); upd();
      });
    }

    // Mirror hanya untuk select åˆ¤å®š (judge)
    function wireJudgeMirror(){
      document.querySelectorAll('select.judge-select').forEach(sel => {
        if (!sel.nextElementSibling || !sel.nextElementSibling.classList.contains('print-text')) {
          const span = document.createElement('span');
          span.className = 'print-text';
          sel.parentNode.insertBefore(span, sel.nextSibling);
        }
        const span = sel.nextElementSibling;
        const upd = () => span.textContent = sel.value;
        sel.addEventListener('change', upd); upd();
      });
    }

    // Render canvas untuk PDF: tampilkan mirror & sembunyikan elemen no-print
    async function renderFormCanvas() {
      const el = document.querySelector('.b5-preview');
      return html2canvas(el, {
        scale: 2,
        backgroundColor: '#FFFFFF',
        useCORS: true,
        onclone: (doc) => {
          doc.querySelectorAll('.no-print').forEach(e => e.style.display = 'none');
          doc.querySelectorAll('.print-text').forEach(e => e.style.display = 'inline');
        }
      });
    }

    // ====== MODIFIKASI: filename menambahkan Customer & å›³ç•ª ======
    async function saveAsPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation:'portrait', unit:'mm', format:'b5' });
      const canvas = await renderFormCanvas();
      doc.addImage(canvas.toDataURL('image/png'), 'PNG', 7, 7, 162, 236);

      // Tanggal untuk prefix
      const makingDate = document.querySelector('input[name="makingdate"]').value;
      const ymd = makingDate
        ? makingDate.replace(/-/g,'')
        : (()=>{
            const t=new Date();
            return t.getFullYear()+String(t.getMonth()+1).padStart(2,'0')+String(t.getDate()).padStart(2,'0');
          })();

      // Ambil Customer (td baris 1 kolom 2) dan å›³ç•ª (td baris 2 kolom 6)
      const sanitize = s => s.replace(/[\\/:*?"<>|]/g,'').trim();
      const customer = sanitize(document.querySelector('.header-table tr:nth-child(1) td:nth-child(2)')?.textContent || 'no-customer');
      const zuban    = sanitize(document.querySelector('.header-table tr:nth-child(2) td:nth-child(6)')?.textContent || 'no-zuban');

      // Field lain seperti sebelumnya (opsional di filename)
      const inputter = sanitize(document.querySelector('select[name="inputter"]')?.value || 'no-name');
      const orderNo  = sanitize(document.querySelector('input[name="order_no"]')?.value || 'no-order');
      const serialNo = sanitize(document.querySelector('input[name="serial_no"]')?.value || 'no-serial');

      // Simpan PDF dengan format: YYYYMMDD_Customer_å›³ç•ª_Inputter_Order_Serial.pdf
      doc.save(`${ymd}_${customer}_${zuban}_${inputter}_${orderNo}_${serialNo}.pdf`);
    }
    // Print via PDF r
    async function printViaPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation:'portrait', unit:'mm', format:'b5' });
      const canvas = await renderFormCanvas();
      doc.addImage(canvas.toDataURL('image/png'), 'PNG', 7, 7, 162, 236);
      if (doc.autoPrint) doc.autoPrint();
      const blobUrl = doc.output('bloburl');
      window.open(blobUrl, '_blank');
    }

    window.addEventListener('load', () => {
      wireJudgeMirror();
      wireDateMirror();
    });
  </script>
</body>
</html>







