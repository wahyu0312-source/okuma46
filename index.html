<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>出荷検査成績書フォームオークマ専用MB46V</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      background: #e7e7e7;
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      font-size: 3mm;
    }
    .b5-preview {
      background: #fff;
      margin: 10mm auto;
      box-shadow: 0 0 5mm #bbb;
      width: 176mm;
      max-width: 98vw;
      padding: 8mm;
      box-sizing: border-box;
      position: relative;
      overflow: hidden;
    }
    h2 { text-align: center; margin: 0 0 6mm 0; font-size: 4mm; letter-spacing: 2mm; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 3mm; }
    th, td {
      border: 0.3mm solid #333;
      padding: 1.2mm 1mm;
      text-align: center;
      font-size: 3mm;
      background: #fff;
    }
    th { background: #f0f0f0; }
    .section-label { text-align: left; font-weight: bold; background: #f9f9f9; }
    input, select {
      box-sizing: border-box;
      font-size: 3mm;
      padding: 0.5mm;
    }
    .button { margin: 3mm 0; padding: 2mm 8mm; font-size: 3mm; }
    .footer { text-align: right; margin-top: 3mm; font-size: 3mm; }
    .stamp-box-row { display: flex; justify-content: flex-end; gap: 2mm; margin-top: 3mm; }
    .signature-wrap {
      display: inline-block; width: 22mm; height: 22mm;
      border: 0.5mm solid #333; border-radius: 2mm;
      background: #fafbfc; position: relative; box-sizing: border-box;
      text-align: center; vertical-align: top; margin-left: 0;
    }
    .signature-label {
      font-size: 2mm; color: #888;
      position: absolute; left: 0; top: 0; width: 100%; height: 100%;
      display: flex; justify-content: center; align-items: center;
      pointer-events: none; z-index: 1;
    }
    .signature-canvas { width: 100%; height: 100%; background: transparent; display: block; border-radius: 2mm; z-index: 2; touch-action: none; }
    .signature-actions { margin-top: 1mm; text-align: right; }
    .signature-actions button {
      font-size: 2mm; padding: 0.5mm 4mm; border-radius: 2mm;
      border: 0.3mm solid #bbb; background: #f8f8f8; cursor: pointer;
      margin-left: 1mm; transition: background .2s;
    }
    .signature-actions button:hover { background: #e3e3e3; }
    .td-flex { display: flex; align-items: center; justify-content: flex-end; gap: 1mm; width: 100%; }
    .td-flex input[type="number"] { width: 60%; min-width: 10mm; max-width: 18mm; text-align: right; }
    .unit-span { min-width: 6mm; text-align: right; font-size: 3mm; margin-left: 1mm; }
    .remark-row td { text-align: left !important; }
    @media print {
      @page { size: B5 portrait; margin: 0; }
      html, body { background: none !important; margin: 0 !important; padding: 0 !important; }
      .b5-preview {
        width: 176mm !important; min-width: 176mm !important; max-width: 176mm !important;
        min-height: 250mm !important; max-height: 250mm !important;
        margin: 0 !important; padding: 6mm !important; background: #fff !important;
        box-shadow: none !important; overflow: hidden !important;
        page-break-after: avoid !important; page-break-inside: avoid !important;
      }
      .button { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="b5-preview" id="form-container">
    <h2>出荷検査成績書</h2>
    <table style="margin-bottom:4mm;">
      <tr>
        <td class="section-label" style="width:25mm;">客先</td>
        <td style="width:50mm;">オークマ株式会社</td>
        <td class="section-label" style="width:18mm;">発行NO.</td>
        <td style="width:28mm;"><input type="text" name="customer_no" id="customer_no" placeholder="例: TTS60-01-460"></td>
        <td class="section-label" style="width:18mm;">発行年月日</td>
        <td style="width:25mm;"><input type="date" name="hakkohiduke"></td>
      </tr>
      <tr>
        <td class="section-label">機種</td>
        <td style="width:50mm;">MB-46V</td></td>
        <td class="section-label">品番</td>
        <td><input type="text" name="part_no" id="part_no" placeholder="例: H1090-0021-02-5"></td>
        <td class="section-label">図番</td>
        <td style="width:50mm;">2825-20</td></td>
      </tr>
      <tr>
        <td class="section-label">品名</td><td>Y軸SG</td>
        <td class="section-label">製造日</td><td style="width:25mm;"><input type="date" name="makingdate"></td>
        <td class="section-label">製造NO</td><td><input type="text" name="part_no" id="part_no" placeholder="例: Y282520-2245"></td>
      </tr>
      <tr><td class="section-label">オーダーNo</td><td colspan="5"><input type="text" name="part_no" id="part_no" placeholder="例: 102P068219-001"></td></tr>
    </table>
    <table>
      <tr><th style="width:50mm;">検査項目</th><th style="width:65mm;">規格</th><th style="width:25mm;">判定</th></tr>
      <tr><td>本体取付け付け方法</td><td>組立架台取付合わせ確認</td><td><select name="judge1"><option>合</option><option>否</option></select></td></tr>
      <tr><td>摺動テスト</td><td>摺動テスト台走り・機能確認</td><td><select name="judge2"><option>合</option><option>否</option></select></td></tr>
      <tr><td>摺動時の異音</td><td>摺動テスト台走り時異音の有無確認</td><td><select name="judge3"><option>有</option><option>無</option></select></td></tr>
      <tr><td>外観検査</td><td>キズ・バリの有無確認</td><td><select name="judge4"><option>合</option><option>否</option></select></td></tr>
      <tr><td>カバーワイパーの除隅</td><td>ワイパー材 t=0.05にて確認</td><td><select name="judge5"><option>合</option><option>否</option></select></td></tr>
      <tr><th colspan="3" style="background:#f8f8f8; text-align:left;">測定項目</th></tr>
      <tr><th>項目</th><th>基準値</th><th>測定値</th></tr>
      <tr>
        <td>収縮時長さ(a)</td><td>190 mm以下</td><td>
          <div class="td-flex">
            <input type="number" step="any" name="a_length" min="0" max="190" placeholder="0-190 mm" onblur="if(this.value!==''&&(parseFloat(this.value)<0||parseFloat(this.value)>190))this.value='';" />
            <span class="unit-span">mm</span>
          </div>
        </td>
      </tr>
      <tr>
        <td>伸長時長さ(b)</td><td>670 mm 以上</td><td>
          <div class="td-flex">
            <input type="number" step="any" name="b_length" min="670" placeholder=">=670 mm" onblur="if(this.value!==''&&parseFloat(this.value)<670)this.value='';" />
            <span class="unit-span">mm</span>
          </div>
        </td>
      </tr>
      <tr>
        <td>カバーストローク(s)</td><td>480 mm 以上</td><td>
          <div class="td-flex">
            <input type="number" step="any" name="s_stroke" min="480" placeholder=">=480 mm" onblur="if(this.value!==''&&parseFloat(this.value)<480)this.value='';" />
            <span class="unit-span">mm</span>
          </div>
        </td>
      </tr>
      <tr>
        <td>初期摺動抵抗</td><td>0 – 4.0 kg</td><td>
          <div class="td-flex">
            <input type="number" step="0.1" name="start_resist" min="0" max="4.0" placeholder="0-4.0 kg" onblur="if(this.value!==''&&(parseFloat(this.value)<0||parseFloat(this.value)>4.0))this.value='';" />
            <span class="unit-span">kg</span>
          </div>
        </td>
      </tr>
      <tr>
        <td>中期摺動抵抗</td><td>0 – 4.0 kg</td><td>
          <div class="td-flex">
            <input type="number" step="0.1" name="mid_resist" min="0" max="4.0" placeholder="0-4.0 kg" onblur="if(this.value!==''&&(parseFloat(this.value)<0||parseFloat(this.value)>4.0))this.value='';" />
            <span class="unit-span">kg</span>
          </div>
        </td>
      </tr>
      <tr>
        <td>終期摺動抵抗</td><td>0 – 4.0 kg</td><td>
          <div class="td-flex">
            <input type="number" step="0.1" name="end_resist" min="0" max="4.0" placeholder="0-4.0 kg" onblur="if(this.value!==''&&(parseFloat(this.value)<0||parseFloat(this.value)>4.0))this.value='';" />
            <span class="unit-span">kg</span>
          </div>
        </td>
      </tr>
    </table>
    <div style="margin-top:2mm;"><label style="font-weight:bold;">総合判定</label><select name="final_judgment"><option>合</option><option>否</option></select></div>
    <div style="margin:2mm 0;"><label style="font-weight:bold;">[備考]</label><input type="text" name="bikou" style="width:70%;" placeholder="例：2821-200の追加加工"></div>
    <button type="button" class="button" onclick="window.print();">印刷 / PDF保存</button>
    <div class="footer">
      東京精密発條株式会社
      <div class="stamp-box-row">
        <div>
          <div style="text-align:center; font-size:2.7mm; margin-bottom:0.5mm;">検印</div>
          <div class="signature-wrap" id="signatureWrap1"><canvas id="signaturePad1" class="signature-canvas"></canvas><span class="signature-label" id="signatureLabel1">署名</span></div>
          <div class="signature-actions"><button type="button" onclick="resizeSignatureCanvas('signaturePad1','signatureLabel1');">クリア</button></div>
        </div>
        <div>
          <div style="text-align:center; font-size:2.7mm; margin-bottom:0.5mm;">検査印</div>
          <div class="signature-wrap" id="signatureWrap2"><canvas id="signaturePad2" class="signature-canvas"></canvas><span class="signature-label" id="signatureLabel2">署名</span></div>
          <div class="signature-actions"><button type="button" onclick="resizeSignatureCanvas('signaturePad2','signatureLabel2');">クリア</button></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function resizeSignatureCanvas(canvasId, labelId) {
      const canvas = document.getElementById(canvasId);
      const label = document.getElementById(labelId);
      const pxPerMM = 3.78; const widthMM = 20, heightMM = 20;
      const ratio = window.devicePixelRatio || 1;
      canvas.width = widthMM * pxPerMM * ratio;
      canvas.height = heightMM * pxPerMM * ratio;
      canvas.style.width = widthMM * pxPerMM + 'px';
      canvas.style.height = heightMM * pxPerMM + 'px';
      const ctx = canvas.getContext('2d');
      ctx.setTransform(ratio,0,0,ratio,0,0);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      label.style.display = '';
    }
    function setupSignaturePad(canvasId, labelId) {
      const canvas = document.getElementById(canvasId); const label = document.getElementById(labelId);
      let drawing=false, lastX=0, lastY=0;
      function getXY(e) { const rect = canvas.getBoundingClientRect();let x,y;
        if(e.touches && e.touches[0]) { x=(e.touches[0].clientX-rect.left)* (canvas.width/ canvas.offsetWidth);
                                          y=(e.touches[0].clientY-rect.top)* (canvas.height/ canvas.offsetHeight);} else {
          x=(e.clientX-rect.left)*(canvas.width/ canvas.offsetWidth);
          y=(e.clientY-rect.top)*(canvas.height/ canvas.offsetHeight);
        }
        return [x,y];
      }
      ['mousedown','touchstart'].forEach(evt => canvas.addEventListener(evt, e=>{drawing=true;[lastX,lastY]=getXY(e);label.style.display='none';}));
      ['mousemove','touchmove'].forEach(evt=>canvas.addEventListener(evt,e=>{if(!drawing)return;const ctx=canvas.getContext('2d');ctx.lineWidth=2.2;ctx.lineCap='round';ctx.strokeStyle='#1a1a1a';ctx.beginPath();ctx.moveTo(lastX,lastY);const [x,y]=getXY(e);ctx.lineTo(x,y);ctx.stroke();[lastX,lastY]=[x,y];e.preventDefault();}));
      ['mouseup','mouseleave','touchend'].forEach(evt=>canvas.addEventListener(evt,()=>{drawing=false;}));
    }
    window.addEventListener('DOMContentLoaded', function(){
      ['signaturePad1','signaturePad2'].forEach((id,i)=>{resizeSignatureCanvas(id,'signatureLabel'+(i+1));setupSignaturePad(id,'signatureLabel'+(i+1));});
      // highlight measurement
      document.querySelectorAll('.td-flex input[type="number"]').forEach(input=>{
        const check=()=>{const val=parseFloat(input.value),thr=parseFloat(input.dataset.threshold),op=input.dataset.operator,row=input.closest('tr');if((op==='lte'&&val>thr)||(op==='gte'&&val<thr)){row.style.backgroundColor='#fdd';}else{row.style.backgroundColor='';}};
        input.addEventListener('input',check);check();
      });
    });
    window.addEventListener('resize',function(){['signaturePad1','signaturePad2'].forEach((id,i)=>resizeSignatureCanvas(id,'signatureLabel'+(i+1)));});
  </script>
</body>
</html>
